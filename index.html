<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exposici√≥n Final LP2</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; scroll-behavior: smooth; }
        
        /* ESTILO GENERAL DE SECCIONES */
        section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        /* 1. PORTADA */
        #portada { background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); color: white; text-align: center; }
        
        /* 2. TEOR√çA */
        #teoria { background-color: #ffffff; }
        .feature-box { padding: 30px; border-radius: 15px; transition: transform 0.3s; height: 100%; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .feature-box:hover { transform: translateY(-10px); background: #f8f9fa; }
        
        /* 3. VISOR DE C√ìDIGO (Estilo VS Code) */
        #codigo { background-color: #1e1e1e; color: #d4d4d4; }
        .vscode-window {
            background-color: #252526;
            width: 100%;
            max-width: 950px;
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            overflow: hidden;
            font-family: 'Fira Code', monospace;
            text-align: left;
        }
        .vscode-header {
            background-color: #333333;
            padding: 10px 15px;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid #1e1e1e;
        }
        .dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .red { background-color: #ff5f56; } .yellow { background-color: #ffbd2e; } .green { background-color: #27c93f; }
        
        .nav-tabs .nav-link { color: #aaaaaa; border: none; background: transparent; font-size: 0.9rem; }
        .nav-tabs .nav-link.active { color: #ffffff; background-color: #1e1e1e; border-top: 2px solid #007acc; }
        
        .code-content { padding: 20px; color: #9cdcfe; font-size: 0.85rem; line-height: 1.6; max-height: 500px; overflow-y: auto; }
        
        /* Colores de Sintaxis Python simulada */
        .kwd { color: #569cd6; } /* def, return, if, else, import, from */
        .str { color: #ce9178; } /* Strings 'text' */
        .num { color: #b5cea8; } /* N√∫meros */
        .com { color: #6a9955; } /* Comentarios */
        .func { color: #dcdcaa; } /* Nombres de funciones */
        .cls { color: #4ec9b0; } /* Clases */

        /* 4. DEMO (Ejecuci√≥n Visual) */
        #demo { background-color: #f0f2f5; }
        .score-circle { width: 100px; height: 100px; background: #2c3e50; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; margin: 0 auto; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">üéì Proyecto Final LP2</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#portada">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="#teoria">L√≥gica</a></li>
                    <li class="nav-item"><a class="nav-link" href="#codigo">C√≥digo Fuente</a></li>
                    <li class="nav-item"><a class="nav-link active" href="#demo">üî¥ Ejecutar</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <section id="portada">
        <div>
            <h1>LIMA HOUSING ANALYTICS</h1>
            <p class="lead">Integraci√≥n de APIs y Open Data para la valoraci√≥n de inmuebles</p>
            <hr class="my-4" style="width: 50%; margin: auto; border-color: rgba(255,255,255,0.3);">
            <p>Mar√≠a Fernanda Ch√°vez Mendoza | 20240703</p>
            <p>Hilary Penelope Cruz Cruz | 20240704</p>
            <a href="#teoria" class="btn btn-outline-light mt-3 rounded-pill">Comenzar Exposici√≥n üëá</a>
        </div>
    </section>

    <section id="teoria">
        <div class="container text-center">
            <h2 class="mb-5 text-dark fw-bold">Nuestra F√≥rmula de Valoraci√≥n</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="feature-box">
                        <div class="display-4 mb-3">üõ°Ô∏è</div>
                        <h4>40% Seguridad</h4>
                        <p class="text-muted small">Exploramos en la API las comisar√≠as cercanas (1km) en los distritos de Lima Metropolitana.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-box">
                        <div class="display-4 mb-3">üí∞</div>
                        <h4>40% Precio</h4>
                        <p class="text-muted small">Evaluaci√≥n de costo-beneficio. Se asigna mayor puntaje a propiedades con menor precio por m¬≤ comparado con el mercado real (Urbania).</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-box">
                        <div class="display-4 mb-3">üé°</div>
                        <h4>20% Servicios</h4>
                        <p class="text-muted small">Escaneo geoespacial (500m) contando <b>Parques</b>, <b>Transporte</b> y <b>Restaurantes</b> para medir habitabilidad.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="codigo">
        <div class="container">
            <h2 class="text-center text-white mb-4">üíª Arquitectura del C√≥digo</h2>
            
            <div class="vscode-window mx-auto">
                <div class="vscode-header">
                    <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
                    <span class="ms-3 text-muted small">Visual Studio Code - Proyecto LP2</span>
                </div>
                
                <ul class="nav nav-tabs px-2 pt-2" id="codeTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="google-tab" data-bs-toggle="tab" data-bs-target="#google" type="button">üêç Google_places_api.py</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="logic-tab" data-bs-toggle="tab" data-bs-target="#logic" type="button">üìÑ data_processor.py</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="app-tab" data-bs-toggle="tab" data-bs-target="#app" type="button">‚öôÔ∏è process_security.py</button>
                    </li>
                </ul>

                <div class="tab-content" id="codeTabContent">
                    
                    <div class="tab-pane fade show active" id="google" role="tabpanel">
                        <div class="code-content">
                            <pre>
<span class="kwd">import</span> googlemaps

<span class="com"># CONFIGURACI√ìN API</span>
API_KEY = <span class="str">'AIzaSyA9yU8036YYM6pXyYOPAHEsV-AUJKT2YYU'</span>
gmaps = googlemaps.Client(key=API_KEY)

<span class="kwd">def</span> <span class="func">analizar_zona_google</span>(lat, lon):
    <span class="func">print</span>(<span class="str">"üìä Analizando el entorno (500m a la redonda)..."</span>)
    
    <span class="com"># --- A. OBTENCI√ìN DE DATOS (API) ---</span>
    res_restaurantes = gmaps.places_nearby(location=(lat, lon), radius=<span class="num">500</span>, type=<span class="str">'restaurant'</span>)
    num_restaurantes = <span class="func">len</span>(res_restaurantes.get(<span class="str">'results'</span>, []))

    res_parques = gmaps.places_nearby(location=(lat, lon), radius=<span class="num">500</span>, type=<span class="str">'park'</span>)
    num_parques = <span class="func">len</span>(res_parques.get(<span class="str">'results'</span>, []))
    
    <span class="com"># Radio ampliado para seguridad (1km)</span>
    res_policia = gmaps.places_nearby(location=(lat, lon), radius=<span class="num">1000</span>, type=<span class="str">'police'</span>)
    num_policia = <span class="func">len</span>(res_policia.get(<span class="str">'results'</span>, []))

    res_transporte = gmaps.places_nearby(location=(lat, lon), radius=<span class="num">500</span>, type=<span class="str">'transit_station'</span>)
    num_transporte = <span class="func">len</span>(res_transporte.get(<span class="str">'results'</span>, []))

    <span class="com"># --- B. C√ÅLCULO DE NOTA ---</span>
    puntaje_calculado = (<span class="func">calcular_nota_servicios</span>(num_parques, num_transporte, num_restaurantes)*<span class="num">0.2</span>)
    puntaje_policia = (<span class="func">calcular_nota_seguridad</span>(num_policia)*<span class="num">0.08</span>)

    <span class="kwd">return</span> {
        <span class="str">"cantidades"</span>: {
            <span class="str">"restaurantes"</span>: num_restaurantes,
            <span class="str">"parques"</span>: num_parques,
            <span class="str">"policia"</span>: num_policia,
            <span class="str">"transporte"</span>: num_transporte
        },
        <span class="str">"puntaje_total"</span>: <span class="func">round</span>(puntaje_calculado, <span class="num">2</span>),
        <span class="str">"puntaje_total_policia"</span>: <span class="func">round</span>(puntaje_policia, <span class="num">2</span>)
    }
                            </pre>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="logic" role="tabpanel">
                        <div class="code-content">
                            <pre>
<span class="kwd">import</span> pandas <span class="kwd">as</span> pd

<span class="com"># Cargamos el dataset hist√≥rico de precios</span>
df = pd.read_csv(<span class="str">'dataset_final.csv'</span>)

<span class="kwd">def</span> <span class="func">evaluar_precio_mercado</span>(distrito, precio_usuario, habitaciones):
    <span class="str">""" Compara el precio ingresado con el promedio de mercado """</span>
    
    <span class="com"># 1. Filtramos por distrito y n√∫mero de habitaciones</span>
    filtro = (df[<span class="str">'district'</span>] == distrito) & (df[<span class="str">'bedrooms'</span>] == habitaciones)
    data_comparable = df[filtro]

    <span class="kwd">if</span> data_comparable.empty:
        <span class="kwd">return</span> <span class="num">5.0</span> <span class="com"># Nota neutra si no hay data</span>

    <span class="com"># 2. Obtenemos el precio promedio real</span>
    precio_mercado = data_comparable[<span class="str">'price_per_m2'</span>].mean()

    <span class="com"># 3. Calculamos diferencia porcentual</span>
    diferencia = (precio_usuario - precio_mercado) / precio_mercado

    <span class="com"># 4. Asignamos nota (M√°s barato = Mejor nota)</span>
    <span class="kwd">if</span> diferencia <= -<span class="num">0.30</span>: <span class="kwd">return</span> <span class="num">10.0</span> <span class="com"># Ofert√≥n</span>
    <span class="kwd">elif</span> diferencia >= <span class="num">0.30</span>: <span class="kwd">return</span> <span class="num">0.0</span> <span class="com"># Muy caro</span>
    <span class="kwd">else</span>:
        nota = <span class="num">5</span> - (diferencia * <span class="num">10</span>)
        <span class="kwd">return</span> <span class="func">round</span>(nota, <span class="num">2</span>)
                            </pre>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="app" role="tabpanel">
                        <div class="code-content">
                            <pre>
<span class="kwd">from</span> flask <span class="kwd">import</span> Flask, render_template, request
<span class="kwd">import</span> Google_places_api
<span class="kwd">import</span> data_processor

<span class="cls">app</span> = Flask(__name__)

<span class="cls">@app</span>.route(<span class="str">'/'</span>, methods=[<span class="str">'GET'</span>, <span class="str">'POST'</span>])
<span class="kwd">def</span> <span class="func">home</span>():
    <span class="kwd">if</span> request.method == <span class="str">'POST'</span>:
        
        <span class="com"># 1. Recibimos Inputs</span>
        lugar = request.form[<span class="str">'lugar'</span>] 
        precio = <span class="func">float</span>(request.form[<span class="str">'precio'</span>])
        hab = <span class="func">int</span>(request.form[<span class="str">'hab'</span>])

        <span class="com"># 2. L√≥gica Inteligente: Detectar Distrito</span>
        <span class="kwd">if</span> <span class="str">","</span> <span class="kwd">in</span> lugar:
            distrito = lugar.split(<span class="str">','</span>)[-<span class="num">1</span>].strip().upper()
        <span class="kwd">else</span>:
            distrito = <span class="str">"LIMA"</span>

        <span class="com"># 3. Procesamiento de Datos</span>
        nota_p = data_processor.evaluar_precio_mercado(distrito, precio, hab)
        coords = Google_places_api.obtener_coordenadas(lugar)
        analisis = Google_places_api.analizar_zona_google(coords)

        <span class="kwd">return</span> render_template(<span class="str">'index.html'</span>, score=nota_p, data=analisis)

    <span class="kwd">return</span> render_template(<span class="str">'index.html'</span>)
                            </pre>
                        </div>
                    </div>

                </div>
            </div>
            <p class="text-center text-muted mt-3 small">M√≥dulos principales del sistema.</p>
        </div>
    </section>

    <section id="demo">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card p-4 shadow-sm border-0">
                        <h3 class="text-center mb-4">üè° Ejecuci√≥n del Sistema</h3>
                        
                        <form action="/" method="POST">
                            <div class="mb-3">
                                <label class="fw-bold">üìç Ubicaci√≥n / Zona:</label>
                                <input type="text" name="lugar" class="form-control form-control-lg" placeholder="Ej: Ceres, Ate" required>
                                <div class="form-text text-muted">La API detectar√° las coordenadas y el distrito autom√°ticamente.</div>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold">üí∞ Precio ($/m¬≤):</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" name="precio" class="form-control" placeholder="Ej: 1500" min="0" required>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold">üõèÔ∏è Habitaciones:</label>
                                <input type="number" name="hab" class="form-control" placeholder="Ej: 3" min="1" max="10" value="3" required>
                            </div>
                            <button type="submit" class="btn btn-dark w-100 py-3 fw-bold">‚ö° Buscar y Analizar</button>
                    </form>

                        {% if puntaje_final %}
                        <hr class="my-4">
                        <div class="text-center">
                            <h4 class="mb-3">Resultado</h4>
                            <div class="score-circle mb-3 shadow">{{ puntaje_final }}</div>
                            <div class="d-flex justify-content-between px-3">
                                <small>üõ°Ô∏è Seg: <b>{{ notas.seguridad }}</b></small>
                                <small>üí∞ Pre: <b>{{ notas.precio }}</b></small>
                                <small>üé° Ser: <b>{{ notas.servicios }}</b></small>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
